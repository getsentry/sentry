from collections.abc import Mapping, Sequence
from datetime import datetime, timedelta
from typing import Any

import sentry_sdk
from rest_framework.exceptions import ValidationError
from rest_framework.request import Request
from rest_framework.response import Response

from sentry import features
from sentry.api.api_publish_status import ApiPublishStatus
from sentry.api.base import region_silo_endpoint
from sentry.api.bases import OrganizationEventsV2EndpointBase
from sentry.constants import MAX_TOP_EVENTS
from sentry.models.dashboard_widget import DashboardWidget, DashboardWidgetTypes
from sentry.models.organization import Organization
from sentry.snuba import (
    discover,
    functions,
    metrics_enhanced_performance,
    metrics_performance,
    spans_indexed,
    spans_metrics,
)
from sentry.snuba.metrics.extraction import MetricSpecType
from sentry.snuba.referrer import Referrer
from sentry.utils.snuba import SnubaError, SnubaTSResult

DATA = {
    "p95(transaction.duration)": {
        "data": [
            [1707951600, [{"count": 301.89509999999984}]],
            [1707955200, [{"count": 295.5127}]],
            [1707958800, [{"count": 273.765}]],
            [1707962400, [{"count": 295.2396}]],
            [1707966000, [{"count": 315.38499999999976}]],
            [1707969600, [{"count": 286.79085}]],
            [1707973200, [{"count": 265.6296999999989}]],
            [1707976800, [{"count": 289.27891429999994}]],
            [1707980400, [{"count": 284.3699999999996}]],
            [1707984000, [{"count": 276.6319499999999}]],
            [1707987600, [{"count": 264.1392}]],
            [1707991200, [{"count": 259.63509999999997}]],
            [1707994800, [{"count": 271.75260249999997}]],
            [1707998400, [{"count": 263.20795}]],
            [1708002000, [{"count": 276.061}]],
            [1708005600, [{"count": 300.55519999999996}]],
            [1708009200, [{"count": 343.59559999999993}]],
            [1708012800, [{"count": 272.3376499999998}]],
            [1708016400, [{"count": 271.7014999999997}]],
            [1708020000, [{"count": 261.089}]],
            [1708023600, [{"count": 278.26285}]],
            [1708027200, [{"count": 302.38449875000003}]],
            [1708030800, [{"count": 273.31890545}]],
            [1708034400, [{"count": 257.65305}]],
            [1708038000, [{"count": 252.22889999999978}]],
            [1708041600, [{"count": 263.02914999999996}]],
            [1708045200, [{"count": 260.8205999999999}]],
            [1708048800, [{"count": 308.33169999999996}]],
            [1708052400, [{"count": 304.39545}]],
            [1708056000, [{"count": 266.082}]],
            [1708059600, [{"count": 276.33304999999996}]],
            [1708063200, [{"count": 256.541}]],
            [1708066800, [{"count": 291.9495999999999}]],
            [1708070400, [{"count": 242.9708}]],
            [1708074000, [{"count": 265.66325}]],
            [1708077600, [{"count": 258.06300309999943}]],
            [1708081200, [{"count": 267.00659999999993}]],
            [1708084800, [{"count": 244.11379999999986}]],
            [1708088400, [{"count": 288.9120999999999}]],
            [1708092000, [{"count": 284.0197955999997}]],
            [1708095600, [{"count": 283.00334999999995}]],
            [1708099200, [{"count": 301.31144999999896}]],
            [1708102800, [{"count": 287.41374999999994}]],
            [1708106400, [{"count": 262.4817499999998}]],
            [1708110000, [{"count": 269.1266}]],
            [1708113600, [{"count": 289.4464999999998}]],
            [1708117200, [{"count": 277.4366999999999}]],
            [1708120800, [{"count": 245.88779999999997}]],
            [1708124400, [{"count": 302.40324999999984}]],
            [1708128000, [{"count": 317.05649999999963}]],
            [1708131600, [{"count": 316.21584999999993}]],
            [1708135200, [{"count": 298.5755999999993}]],
            [1708138800, [{"count": 334.1743499999997}]],
            [1708142400, [{"count": 274.65599999999995}]],
            [1708146000, [{"count": 291.4862999999999}]],
            [1708149600, [{"count": 300.75675}]],
            [1708153200, [{"count": 316.02874999999995}]],
            [1708156800, [{"count": 327.01564999999874}]],
            [1708160400, [{"count": 295.58820000000003}]],
            [1708164000, [{"count": 320.43600000000004}]],
            [1708167600, [{"count": 316.6773499999999}]],
            [1708171200, [{"count": 330.117}]],
            [1708174800, [{"count": 308.1909499999996}]],
            [1708178400, [{"count": 264.5625999999999}]],
            [1708182000, [{"count": 315.99074999999976}]],
            [1708185600, [{"count": 258.2173999999995}]],
            [1708189200, [{"count": 332.8687}]],
            [1708192800, [{"count": 327.74408709999994}]],
            [1708196400, [{"count": 317.18079999999986}]],
            [1708200000, [{"count": 326.2407999999999}]],
            [1708203600, [{"count": 304.71863469999994}]],
            [1708207200, [{"count": 319.9751999999997}]],
            [1708210800, [{"count": 324.52136535}]],
            [1708214400, [{"count": 303.752}]],
            [1708218000, [{"count": 314.47799999999995}]],
            [1708221600, [{"count": 275.8296499999999}]],
            [1708225200, [{"count": 343.71484999999996}]],
            [1708228800, [{"count": 320.32599999999985}]],
            [1708232400, [{"count": 342.77029999999996}]],
            [1708236000, [{"count": 340.79409999999984}]],
            [1708239600, [{"count": 315.4510499999999}]],
            [1708243200, [{"count": 281.32859999999994}]],
            [1708246800, [{"count": 311.0793999999997}]],
            [1708250400, [{"count": 310.34129999999965}]],
            [1708254000, [{"count": 315.96755544999996}]],
            [1708257600, [{"count": 299.48650000000015}]],
            [1708261200, [{"count": 299.0375499999999}]],
            [1708264800, [{"count": 330.0341500000002}]],
            [1708268400, [{"count": 350.2445999999999}]],
            [1708272000, [{"count": 322.8648}]],
            [1708275600, [{"count": 321.91524999999984}]],
            [1708279200, [{"count": 312.519}]],
            [1708282800, [{"count": 329.6252499999999}]],
            [1708286400, [{"count": 344.1723999999999}]],
            [1708290000, [{"count": 319.6522499999997}]],
            [1708293600, [{"count": 366.10175000000004}]],
            [1708297200, [{"count": 332.67189999999994}]],
            [1708300800, [{"count": 280.8872}]],
            [1708304400, [{"count": 296.59669999999926}]],
            [1708308000, [{"count": 295.19399999999996}]],
            [1708311600, [{"count": 299.68125}]],
            [1708315200, [{"count": 276.75585}]],
            [1708318800, [{"count": 275.8416999999996}]],
            [1708322400, [{"count": 269.7173499999999}]],
            [1708326000, [{"count": 252.5487999999999}]],
            [1708329600, [{"count": 257.7925}]],
            [1708333200, [{"count": 254.03465}]],
            [1708336800, [{"count": 267.7678999999999}]],
            [1708340400, [{"count": 268.60040000000004}]],
            [1708344000, [{"count": 268.90335}]],
            [1708347600, [{"count": 291.18319999999994}]],
            [1708351200, [{"count": 263.9842999999996}]],
            [1708354800, [{"count": 288.159}]],
            [1708358400, [{"count": 273.99769999999995}]],
            [1708362000, [{"count": 262.17149999999987}]],
            [1708365600, [{"count": 266.86400000000003}]],
            [1708369200, [{"count": 265.74075}]],
            [1708372800, [{"count": 299.2985499999998}]],
            [1708376400, [{"count": 282.9881999999998}]],
            [1708380000, [{"count": 316.7190999999999}]],
            [1708383600, [{"count": 313.60884999999996}]],
            [1708387200, [{"count": 304.8226999999998}]],
            [1708390800, [{"count": 288.55759999999873}]],
            [1708394400, [{"count": 292.44984999999997}]],
            [1708398000, [{"count": 272.95215}]],
            [1708401600, [{"count": 298.22594999999995}]],
            [1708405200, [{"count": 279.8187999999996}]],
            [1708408800, [{"count": 283.69339999999994}]],
            [1708412400, [{"count": 261.26540000000006}]],
            [1708416000, [{"count": 277.42434999999995}]],
            [1708419600, [{"count": 255.568599999999}]],
            [1708423200, [{"count": 259.2113}]],
            [1708426800, [{"count": 233.0464999999998}]],
            [1708430400, [{"count": 269.64334999999994}]],
            [1708434000, [{"count": 249.71706894999994}]],
            [1708437600, [{"count": 281.19794999999993}]],
            [1708441200, [{"count": 304.83169999999996}]],
            [1708444800, [{"count": 293.304}]],
            [1708448400, [{"count": 294.9658}]],
            [1708452000, [{"count": 266.17595}]],
            [1708455600, [{"count": 246.6515999999998}]],
            [1708459200, [{"count": 275.35200000000003}]],
            [1708462800, [{"count": 239.35799999999992}]],
            [1708466400, [{"count": 275.4290499999999}]],
            [1708470000, [{"count": 266.53359999999986}]],
            [1708473600, [{"count": 276.2018}]],
            [1708477200, [{"count": 277.34820129999963}]],
            [1708480800, [{"count": 283.5891}]],
            [1708484400, [{"count": 283.2065999999995}]],
            [1708488000, [{"count": 275.47234999999995}]],
            [1708491600, [{"count": 287.9125}]],
            [1708495200, [{"count": 260.1249}]],
            [1708498800, [{"count": 276.884}]],
            [1708502400, [{"count": 283.7236499999999}]],
            [1708506000, [{"count": 259.3475999999999}]],
            [1708509600, [{"count": 277.39644999999996}]],
            [1708513200, [{"count": 242.70024999999998}]],
            [1708516800, [{"count": 279.9721999999998}]],
            [1708520400, [{"count": 251.74450000000002}]],
            [1708524000, [{"count": 307.3124999999999}]],
            [1708527600, [{"count": 289.5143999999997}]],
            [1708531200, [{"count": 327.08124999999995}]],
            [1708534800, [{"count": 234.60399999999947}]],
            [1708538400, [{"count": 295.1940499999999}]],
            [1708542000, [{"count": 263.19715949999994}]],
            [1708545600, [{"count": 265.9751499999999}]],
            [1708549200, [{"count": 233.3125}]],
            [1708552800, [{"count": 267.95849999999996}]],
            [1708556400, [{"count": 312.6989091000005}]],
            [1708560000, [{"count": 294.05269999999996}]],
            [1708563600, [{"count": 305.29599999999874}]],
            [1708567200, [{"count": 301.0869005499999}]],
            [1708570800, [{"count": 260.9830000000001}]],
            [1708574400, [{"count": 299.3606999999997}]],
            [1708578000, [{"count": 284.3728499999994}]],
            [1708581600, [{"count": 302.02174999999994}]],
            [1708585200, [{"count": 268.63225}]],
            [1708588800, [{"count": 268.2290999999999}]],
            [1708592400, [{"count": 283.6728725}]],
            [1708596000, [{"count": 272.28069999999997}]],
            [1708599600, [{"count": 290.69994509999924}]],
            [1708603200, [{"count": 251.6345}]],
            [1708606800, [{"count": 262.95489999999995}]],
            [1708610400, [{"count": 273.28764999999987}]],
            [1708614000, [{"count": 256.13268419999997}]],
            [1708617600, [{"count": 265.32354999999984}]],
            [1708621200, [{"count": 267.3255499999999}]],
            [1708624800, [{"count": 276.37545}]],
            [1708628400, [{"count": 262.61389999999926}]],
            [1708632000, [{"count": 259.846}]],
            [1708635600, [{"count": 261.2562}]],
            [1708639200, [{"count": 274.36899889999995}]],
            [1708642800, [{"count": 268.11029999999994}]],
            [1708646400, [{"count": 308.21549999999996}]],
            [1708650000, [{"count": 310.75819999999993}]],
            [1708653600, [{"count": 278.41535}]],
            [1708657200, [{"count": 254.4588499999999}]],
            [1708660800, [{"count": 287.85344999999984}]],
            [1708664400, [{"count": 289.86699999999996}]],
            [1708668000, [{"count": 288.31044999999995}]],
            [1708671600, [{"count": 256.39459999999997}]],
            [1708675200, [{"count": 271.67254999999994}]],
            [1708678800, [{"count": 259.8046499999999}]],
            [1708682400, [{"count": 267.05339999999995}]],
            [1708686000, [{"count": 268.62750000000005}]],
            [1708689600, [{"count": 259.029}]],
            [1708693200, [{"count": 256.4409999999997}]],
            [1708696800, [{"count": 267.2361439}]],
            [1708700400, [{"count": 256.8728}]],
            [1708704000, [{"count": 279.92975}]],
            [1708707600, [{"count": 272.0802499999998}]],
            [1708711200, [{"count": 323.00214999999986}]],
            [1708714800, [{"count": 398.72544999999985}]],
            [1708718400, [{"count": 411.67659999999955}]],
            [1708722000, [{"count": 304.1270999999999}]],
            [1708725600, [{"count": 406.27729999999985}]],
            [1708729200, [{"count": 371.5857999999995}]],
            [1708732800, [{"count": 372.9758499999999}]],
            [1708736400, [{"count": 469.5417499999977}]],
            [1708740000, [{"count": 383.1793499999999}]],
            [1708743600, [{"count": 366.92361265}]],
            [1708747200, [{"count": 379.2332499999998}]],
            [1708750800, [{"count": 311.8320499999996}]],
            [1708754400, [{"count": 350.3822999999999}]],
            [1708758000, [{"count": 391.9711999999994}]],
            [1708761600, [{"count": 411.7998499999998}]],
            [1708765200, [{"count": 410.8347999999992}]],
            [1708768800, [{"count": 383.1496999999998}]],
            [1708772400, [{"count": 338.70994999999994}]],
            [1708776000, [{"count": 322.2134}]],
            [1708779600, [{"count": 451.64714999999995}]],
            [1708783200, [{"count": 306.24844819999976}]],
            [1708786800, [{"count": 346.12594999999953}]],
            [1708790400, [{"count": 334.18904999999995}]],
            [1708794000, [{"count": 363.17654999999974}]],
            [1708797600, [{"count": 369.42355445}]],
            [1708801200, [{"count": 341.5407999999995}]],
            [1708804800, [{"count": 375.2039990999999}]],
            [1708808400, [{"count": 415.10169999999994}]],
            [1708812000, [{"count": 403.50479999999936}]],
            [1708815600, [{"count": 392.84484999999927}]],
            [1708819200, [{"count": 415.92823299999986}]],
            [1708822800, [{"count": 439.65124999999983}]],
            [1708826400, [{"count": 387.33450000000005}]],
            [1708830000, [{"count": 377.8311499999999}]],
            [1708833600, [{"count": 390.328}]],
            [1708837200, [{"count": 366.0081}]],
            [1708840800, [{"count": 349.76800000000003}]],
            [1708844400, [{"count": 383.70079999999996}]],
            [1708848000, [{"count": 315.70109999999926}]],
            [1708851600, [{"count": 418.25244999999995}]],
            [1708855200, [{"count": 441.28919999999994}]],
            [1708858800, [{"count": 427.5585999999999}]],
            [1708862400, [{"count": 439.5357957999996}]],
            [1708866000, [{"count": 471.8446}]],
            [1708869600, [{"count": 460.0909999999994}]],
            [1708873200, [{"count": 475.2964999999999}]],
            [1708876800, [{"count": 466.13370399999997}]],
            [1708880400, [{"count": 411.81319999999994}]],
            [1708884000, [{"count": 428.7625999999999}]],
            [1708887600, [{"count": 500.71018569999995}]],
            [1708891200, [{"count": 481.17149999999896}]],
            [1708894800, [{"count": 480.0686999999998}]],
            [1708898400, [{"count": 434.24995}]],
            [1708902000, [{"count": 350.0795}]],
            [1708905600, [{"count": 403.7604999999998}]],
            [1708909200, [{"count": 394.817349999999}]],
            [1708912800, [{"count": 421.08969999999965}]],
            [1708916400, [{"count": 353.4329499999997}]],
            [1708920000, [{"count": 356.8456999999993}]],
            [1708923600, [{"count": 310.09125}]],
            [1708927200, [{"count": 350.81074999999976}]],
            [1708930800, [{"count": 328.89}]],
            [1708934400, [{"count": 329.5231}]],
            [1708938000, [{"count": 377.3322499999998}]],
            [1708941600, [{"count": 346.54525}]],
            [1708945200, [{"count": 341.573484}]],
            [1708948800, [{"count": 374.8811499999997}]],
            [1708952400, [{"count": 407.1662999999998}]],
            [1708956000, [{"count": 327.37940000000003}]],
            [1708959600, [{"count": 650.3930499999996}]],
            [1708963200, [{"count": 919.2488999999981}]],
            [1708966800, [{"count": 842.6453499999996}]],
            [1708970400, [{"count": 1224.9936999999964}]],
            [1708974000, [{"count": 2042.6338999999969}]],
            [1708977600, [{"count": 2058.9201}]],
            [1708981200, [{"count": 1093.6620499999988}]],
            [1708984800, [{"count": 2431.2799999999997}]],
            [1708988400, [{"count": 1251.8064235}]],
            [1708992000, [{"count": 279.75684999999993}]],
            [1708995600, [{"count": 253.19500000000002}]],
            [1708999200, [{"count": 261.37209999999993}]],
            [1709002800, [{"count": 268.8194}]],
            [1709006400, [{"count": 260.0825499999998}]],
            [1709010000, [{"count": 226.732}]],
            [1709013600, [{"count": 242.1619}]],
            [1709017200, [{"count": 238.16839999999988}]],
            [1709020800, [{"count": 262.1325499999999}]],
            [1709024400, [{"count": 224.72575}]],
            [1709028000, [{"count": 263.36154999999997}]],
            [1709031600, [{"count": 240.6208499999997}]],
            [1709035200, [{"count": 236.79184999999993}]],
            [1709038800, [{"count": 251.14302279999993}]],
            [1709042400, [{"count": 271.55539999999996}]],
            [1709046000, [{"count": 320.6174}]],
            [1709049600, [{"count": 326.6527}]],
            [1709053200, [{"count": 284.433}]],
            [1709056800, [{"count": 311.17215}]],
            [1709060400, [{"count": 328.8217999999998}]],
            [1709064000, [{"count": 319.98209999999995}]],
            [1709067600, [{"count": 413.0918951999996}]],
            [1709071200, [{"count": 357.9738}]],
            [1709074800, [{"count": 475.3829999999997}]],
            [1709078400, [{"count": 397.94899999999984}]],
            [1709082000, [{"count": 418.11014999999975}]],
            [1709085600, [{"count": 366.06}]],
            [1709089200, [{"count": 404.5900999999993}]],
            [1709092800, [{"count": 372.16799999999984}]],
            [1709096400, [{"count": 401.0799644499997}]],
            [1709100000, [{"count": 389.53829999999857}]],
            [1709103600, [{"count": 369.4323999999999}]],
            [1709107200, [{"count": 351.17319999999984}]],
            [1709110800, [{"count": 396.9542999999999}]],
            [1709114400, [{"count": 405.16439999999557}]],
            [1709118000, [{"count": 407.8155499999999}]],
            [1709121600, [{"count": 435.56134999999995}]],
            [1709125200, [{"count": 507.48764999999986}]],
            [1709128800, [{"count": 715.49965}]],
            [1709132400, [{"count": 640.7129499999998}]],
            [1709136000, [{"count": 372.14275}]],
            [1709139600, [{"count": 430.87525000000005}]],
            [1709143200, [{"count": 337.75434999999993}]],
            [1709146800, [{"count": 358.70325}]],
            [1709150400, [{"count": 411.83299999999997}]],
            [1709154000, [{"count": 430.7873999999997}]],
            [1709157600, [{"count": 595.5382499999995}]],
            [1709161200, [{"count": 671.1321499999999}]],
            [1709164800, [{"count": 1161.299399999996}]],
            [1709168400, [{"count": 805.7358499999987}]],
            [1709172000, [{"count": 815.5806499999999}]],
            [1709175600, [{"count": 823.9045}]],
            [1709179200, [{"count": 743.3656999999996}]],
            [1709182800, [{"count": 741.7580999999998}]],
            [1709186400, [{"count": 1761.3736}]],
            [1709190000, [{"count": 662.5808499999998}]],
            [1709193600, [{"count": 809.8624999999986}]],
            [1709197200, [{"count": 932.1020999999985}]],
            [1709200800, [{"count": 855.68355}]],
            [1709204400, [{"count": 793.0995999999946}]],
            [1709208000, [{"count": 866.4301499999999}]],
            [1709211600, [{"count": 900.3473999999987}]],
            [1709215200, [{"count": 702.989199999999}]],
            [1709218800, [{"count": 686.5799499999994}]],
            [1709222400, [{"count": 1482.4111999999973}]],
            [1709226000, [{"count": 1041.231999999995}]],
            [1709229600, [{"count": 648.1812999999986}]],
            [1709233200, [{"count": 811.710849999999}]],
            [1709236800, [{"count": 739.37635}]],
            [1709240400, [{"count": 687.2343770499995}]],
            [1709244000, [{"count": 799.4565058000001}]],
            [1709247600, [{"count": 756.1422999999999}]],
            [1709251200, [{"count": 776.6038499999999}]],
            [1709254800, [{"count": 798.5062499999999}]],
            [1709258400, [{"count": 664.77505}]],
            [1709262000, [{"count": 576.8418999999992}]],
            [1709265600, [{"count": 674.1712500000001}]],
            [1709269200, [{"count": 785.7252499999987}]],
            [1709272800, [{"count": 1381.1427999999896}]],
            [1709276400, [{"count": 735.0585499999999}]],
            [1709280000, [{"count": 1128.618470349984}]],
            [1709283600, [{"count": 1278.5628999999599}]],
            [1709287200, [{"count": 1794.6246}]],
            [1709290800, [{"count": 1935.033649999999}]],
            [1709294400, [{"count": 1033.29775}]],
            [1709298000, [{"count": 1184.7424499999909}]],
            [1709301600, [{"count": 741.4869999999996}]],
            [1709305200, [{"count": 587.7466499999991}]],
            [1709308800, [{"count": 652.7442999999998}]],
            [1709312400, [{"count": 652.19}]],
            [1709316000, [{"count": 635.87185}]],
            [1709319600, [{"count": 926.9790499999999}]],
            [1709323200, [{"count": 2208.609199999999}]],
            [1709326800, [{"count": 1206.2369999999996}]],
            [1709330400, [{"count": 845.0378499999931}]],
            [1709334000, [{"count": 2134.0536999999995}]],
            [1709337600, [{"count": 784.1374499999995}]],
            [1709341200, [{"count": 1770.653749999999}]],
            [1709344800, [{"count": 2111.59}]],
            [1709348400, [{"count": 1934.7398999999996}]],
            [1709352000, [{"count": 1401.5211499999996}]],
            [1709355600, [{"count": 1408.4356999999984}]],
            [1709359200, [{"count": 1585.269249999999}]],
            [1709362800, [{"count": 1717.5044499999988}]],
            [1709366400, [{"count": 1995.8545}]],
            [1709370000, [{"count": 1640.0117999999993}]],
            [1709373600, [{"count": 1167.7685499999995}]],
            [1709377200, [{"count": 1745.2684499999996}]],
            [1709380800, [{"count": 1619.4541}]],
            [1709384400, [{"count": 1918.9817999999977}]],
            [1709388000, [{"count": 1822.0296999999941}]],
            [1709391600, [{"count": 922.5240999999996}]],
            [1709395200, [{"count": 1509.1656999999998}]],
            [1709398800, [{"count": 1900.568599999994}]],
            [1709402400, [{"count": 1277.1124499999994}]],
            [1709406000, [{"count": 1993.6479999999997}]],
            [1709409600, [{"count": 1681.0363499999999}]],
            [1709413200, [{"count": 2046.9467499999996}]],
            [1709416800, [{"count": 1503.7923999999996}]],
            [1709420400, [{"count": 1907.8865500000002}]],
            [1709424000, [{"count": 1873.9804000000001}]],
            [1709427600, [{"count": 1870.1034999999993}]],
            [1709431200, [{"count": 1904.642}]],
            [1709434800, [{"count": 1833.2167499999994}]],
            [1709438400, [{"count": 1888.4074999999998}]],
            [1709442000, [{"count": 1607.2701999999997}]],
            [1709445600, [{"count": 1915.0262999999993}]],
            [1709449200, [{"count": 1452.759599999999}]],
            [1709452800, [{"count": 1868.965}]],
            [1709456400, [{"count": 1628.72815}]],
            [1709460000, [{"count": 1955.25135}]],
            [1709463600, [{"count": 1974.4263499999995}]],
            [1709467200, [{"count": 1614.3591499999995}]],
            [1709470800, [{"count": 1869.2775499999998}]],
            [1709474400, [{"count": 2064.1532999999968}]],
            [1709478000, [{"count": 1601.1113999999982}]],
            [1709481600, [{"count": 1533.2578499999975}]],
            [1709485200, [{"count": 2056.8922499999985}]],
            [1709488800, [{"count": 1935.6291999999994}]],
            [1709492400, [{"count": 1876.186517199999}]],
            [1709496000, [{"count": 2251.291}]],
            [1709499600, [{"count": 1975.7197499999993}]],
            [1709503200, [{"count": 1734.8251499999978}]],
            [1709506800, [{"count": 1998.2542999999978}]],
            [1709510400, [{"count": 1933.2677499999993}]],
            [1709514000, [{"count": 1978.9815999999996}]],
            [1709517600, [{"count": 1972.7519643499995}]],
            [1709521200, [{"count": 1871.2007999999996}]],
            [1709524800, [{"count": 1907.1953999999996}]],
            [1709528400, [{"count": 2014.0838999999994}]],
            [1709532000, [{"count": 1135.9746499999976}]],
            [1709535600, [{"count": 1219.3811999999964}]],
            [1709539200, [{"count": 1222.2316499999938}]],
            [1709542800, [{"count": 1115.5040999999999}]],
            [1709546400, [{"count": 1931.518549999999}]],
            [1709550000, [{"count": 1107.472449999998}]],
            [1709553600, [{"count": 1889.2416999999991}]],
            [1709557200, [{"count": 2041.1576999999997}]],
            [1709560800, [{"count": 1855.9678999999994}]],
            [1709564400, [{"count": 1313.5857000000155}]],
            [1709568000, [{"count": 1134.2925499999992}]],
            [1709571600, [{"count": 1021.7908999999958}]],
            [1709575200, [{"count": 1851.0008499999938}]],
            [1709578800, [{"count": 1393.3055999999951}]],
            [1709582400, [{"count": 1759.6851999999992}]],
            [1709586000, [{"count": 1418.5491499999957}]],
            [1709589600, [{"count": 2021.6890499999872}]],
            [1709593200, [{"count": 1877.0819999999944}]],
            [1709596800, [{"count": 1061.6667499999953}]],
            [1709600400, [{"count": 817.49665}]],
            [1709604000, [{"count": 1146.5286499999968}]],
            [1709607600, [{"count": 787.900499999999}]],
            [1709611200, [{"count": 2146.2535}]],
            [1709614800, [{"count": 789.4261499999974}]],
            [1709618400, [{"count": 2034.4527499999988}]],
            [1709622000, [{"count": 928.6795500000006}]],
            [1709625600, [{"count": 1005.3322}]],
            [1709629200, [{"count": 910.7150499999988}]],
            [1709632800, [{"count": 1066.1275999999907}]],
            [1709636400, [{"count": 2698.279749999999}]],
            [1709640000, [{"count": 959.281899999999}]],
            [1709643600, [{"count": 3298.707699999998}]],
            [1709647200, [{"count": 759.0128499999989}]],
            [1709650800, [{"count": 1820.9323999999747}]],
            [1709654400, [{"count": 1092.4674999999936}]],
            [1709658000, [{"count": 2707.4367999999977}]],
            [1709661600, [{"count": 772.3305499999996}]],
            [1709665200, [{"count": 948.4220500000029}]],
            [1709668800, [{"count": 719.2436499999992}]],
            [1709672400, [{"count": 798.5205499999993}]],
            [1709676000, [{"count": 2075.829979}]],
            [1709679600, [{"count": 891.2644999999994}]],
            [1709683200, [{"count": 856.4466499999999}]],
            [1709686800, [{"count": 553.56475}]],
            [1709690400, [{"count": 1043.127349999999}]],
            [1709694000, [{"count": 2322.74705}]],
            [1709697600, [{"count": 516.0951999999994}]],
            [1709701200, [{"count": 2038.6212499999967}]],
            [1709704800, [{"count": 829.9065499999995}]],
            [1709708400, [{"count": 2844.874999999998}]],
            [1709712000, [{"count": 922.9752499999983}]],
            [1709715600, [{"count": 794.4968499999998}]],
            [1709719200, [{"count": 2171.5444499999976}]],
            [1709722800, [{"count": 1985.1377999999997}]],
            [1709726400, [{"count": 843.0413999999996}]],
            [1709730000, [{"count": 1065.5962999999986}]],
            [1709733600, [{"count": 1234.7250499999961}]],
            [1709737200, [{"count": 713.7986999999991}]],
            [1709740800, [{"count": 848.9329499999991}]],
            [1709744400, [{"count": 691.686}]],
            [1709748000, [{"count": 937.38745}]],
            [1709751600, [{"count": 947.5511936999997}]],
            [1709755200, [{"count": 2171.286}]],
            [1709758800, [{"count": 1935.3285999999976}]],
            [1709762400, [{"count": 1874.0067999999962}]],
            [1709766000, [{"count": 914.7697999999975}]],
            [1709769600, [{"count": 1037.0532135499961}]],
            [1709773200, [{"count": 916.4733999999983}]],
            [1709776800, [{"count": 668.1553499999992}]],
            [1709780400, [{"count": 758.6165999999998}]],
            [1709784000, [{"count": 684.6239999999996}]],
            [1709787600, [{"count": 1130.2224999999999}]],
            [1709791200, [{"count": 1291.9560220499932}]],
            [1709794800, [{"count": 728.6304999999995}]],
            [1709798400, [{"count": 2620.732249999998}]],
            [1709802000, [{"count": 2277.215599999996}]],
            [1709805600, [{"count": 2243.4460999999906}]],
            [1709809200, [{"count": 1164.2167999999986}]],
            [1709812800, [{"count": 2872.8076499999997}]],
            [1709816400, [{"count": 3579.4846999999922}]],
            [1709820000, [{"count": 951.1588999999987}]],
            [1709823600, [{"count": 769.8711499999982}]],
            [1709827200, [{"count": 1023.046}]],
            [1709830800, [{"count": 760.4165499999992}]],
            [1709834400, [{"count": 734.2579499999999}]],
        ],
        "order": 0,
        "isMetricsData": True,
        "start": 1707951600,
        "end": 1709838000,
        "meta": {
            "fields": {"time": "date", "p95_transaction_duration": "duration", "count": "integer"},
            "units": {"time": None, "p95_transaction_duration": "millisecond", "count": None},
            "isMetricsData": True,
            "isMetricsExtractedData": False,
            "tips": {},
            "datasetReason": "unchanged",
            "dataset": "metrics",
        },
    },
    "count()": {
        "data": [
            [1707951600, [{"count": 3935}]],
            [1707955200, [{"count": 13510}]],
            [1707958800, [{"count": 2671}]],
            [1707962400, [{"count": 13836}]],
            [1707966000, [{"count": 3250}]],
            [1707969600, [{"count": 12074}]],
            [1707973200, [{"count": 4798}]],
            [1707976800, [{"count": 11139}]],
            [1707980400, [{"count": 4864}]],
            [1707984000, [{"count": 11040}]],
            [1707987600, [{"count": 5525}]],
            [1707991200, [{"count": 10845}]],
            [1707994800, [{"count": 6251}]],
            [1707998400, [{"count": 9867}]],
            [1708002000, [{"count": 7246}]],
            [1708005600, [{"count": 9482}]],
            [1708009200, [{"count": 6974}]],
            [1708012800, [{"count": 9632}]],
            [1708016400, [{"count": 11189}]],
            [1708020000, [{"count": 8922}]],
            [1708023600, [{"count": 8342}]],
            [1708027200, [{"count": 9268}]],
            [1708030800, [{"count": 9743}]],
            [1708034400, [{"count": 11077}]],
            [1708038000, [{"count": 7558}]],
            [1708041600, [{"count": 8430}]],
            [1708045200, [{"count": 7749}]],
            [1708048800, [{"count": 7459}]],
            [1708052400, [{"count": 8419}]],
            [1708056000, [{"count": 7013}]],
            [1708059600, [{"count": 9338}]],
            [1708063200, [{"count": 6341}]],
            [1708066800, [{"count": 10233}]],
            [1708070400, [{"count": 5529}]],
            [1708074000, [{"count": 10820}]],
            [1708077600, [{"count": 4723}]],
            [1708081200, [{"count": 11361}]],
            [1708084800, [{"count": 4349}]],
            [1708088400, [{"count": 11810}]],
            [1708092000, [{"count": 4483}]],
            [1708095600, [{"count": 11806}]],
            [1708099200, [{"count": 4648}]],
            [1708102800, [{"count": 12937}]],
            [1708106400, [{"count": 4888}]],
            [1708110000, [{"count": 12741}]],
            [1708113600, [{"count": 3763}]],
            [1708117200, [{"count": 13701}]],
            [1708120800, [{"count": 3885}]],
            [1708124400, [{"count": 13137}]],
            [1708128000, [{"count": 2767}]],
            [1708131600, [{"count": 12736}]],
            [1708135200, [{"count": 4514}]],
            [1708138800, [{"count": 10951}]],
            [1708142400, [{"count": 4193}]],
            [1708146000, [{"count": 12192}]],
            [1708149600, [{"count": 3336}]],
            [1708153200, [{"count": 12593}]],
            [1708156800, [{"count": 2660}]],
            [1708160400, [{"count": 13384}]],
            [1708164000, [{"count": 1749}]],
            [1708167600, [{"count": 14134}]],
            [1708171200, [{"count": 1141}]],
            [1708174800, [{"count": 14262}]],
            [1708178400, [{"count": 1105}]],
            [1708182000, [{"count": 14127}]],
            [1708185600, [{"count": 1413}]],
            [1708189200, [{"count": 13823}]],
            [1708192800, [{"count": 1538}]],
            [1708196400, [{"count": 13663}]],
            [1708200000, [{"count": 1975}]],
            [1708203600, [{"count": 13272}]],
            [1708207200, [{"count": 2460}]],
            [1708210800, [{"count": 14298}]],
            [1708214400, [{"count": 1796}]],
            [1708218000, [{"count": 13640}]],
            [1708221600, [{"count": 1800}]],
            [1708225200, [{"count": 13032}]],
            [1708228800, [{"count": 2235}]],
            [1708232400, [{"count": 13138}]],
            [1708236000, [{"count": 2387}]],
            [1708239600, [{"count": 12600}]],
            [1708243200, [{"count": 3637}]],
            [1708246800, [{"count": 11697}]],
            [1708250400, [{"count": 4328}]],
            [1708254000, [{"count": 10973}]],
            [1708257600, [{"count": 4895}]],
            [1708261200, [{"count": 10344}]],
            [1708264800, [{"count": 5440}]],
            [1708268400, [{"count": 11364}]],
            [1708272000, [{"count": 5862}]],
            [1708275600, [{"count": 9399}]],
            [1708279200, [{"count": 6211}]],
            [1708282800, [{"count": 8913}]],
            [1708286400, [{"count": 6605}]],
            [1708290000, [{"count": 8553}]],
            [1708293600, [{"count": 7016}]],
            [1708297200, [{"count": 8333}]],
            [1708300800, [{"count": 7849}]],
            [1708304400, [{"count": 7703}]],
            [1708308000, [{"count": 8151}]],
            [1708311600, [{"count": 7356}]],
            [1708315200, [{"count": 8962}]],
            [1708318800, [{"count": 6955}]],
            [1708322400, [{"count": 9929}]],
            [1708326000, [{"count": 6373}]],
            [1708329600, [{"count": 10828}]],
            [1708333200, [{"count": 6172}]],
            [1708336800, [{"count": 11638}]],
            [1708340400, [{"count": 6019}]],
            [1708344000, [{"count": 11522}]],
            [1708347600, [{"count": 5032}]],
            [1708351200, [{"count": 11800}]],
            [1708354800, [{"count": 4676}]],
            [1708358400, [{"count": 12850}]],
            [1708362000, [{"count": 4707}]],
            [1708365600, [{"count": 12262}]],
            [1708369200, [{"count": 4036}]],
            [1708372800, [{"count": 12404}]],
            [1708376400, [{"count": 3767}]],
            [1708380000, [{"count": 12631}]],
            [1708383600, [{"count": 3954}]],
            [1708387200, [{"count": 12822}]],
            [1708390800, [{"count": 3045}]],
            [1708394400, [{"count": 13146}]],
            [1708398000, [{"count": 2788}]],
            [1708401600, [{"count": 13967}]],
            [1708405200, [{"count": 2477}]],
            [1708408800, [{"count": 13877}]],
            [1708412400, [{"count": 2173}]],
            [1708416000, [{"count": 14624}]],
            [1708419600, [{"count": 2230}]],
            [1708423200, [{"count": 14910}]],
            [1708426800, [{"count": 1643}]],
            [1708430400, [{"count": 15041}]],
            [1708434000, [{"count": 2148}]],
            [1708437600, [{"count": 14281}]],
            [1708441200, [{"count": 2247}]],
            [1708444800, [{"count": 15172}]],
            [1708448400, [{"count": 2879}]],
            [1708452000, [{"count": 14788}]],
            [1708455600, [{"count": 2645}]],
            [1708459200, [{"count": 14146}]],
            [1708462800, [{"count": 4167}]],
            [1708466400, [{"count": 13595}]],
            [1708470000, [{"count": 3793}]],
            [1708473600, [{"count": 15336}]],
            [1708477200, [{"count": 1562}]],
            [1708480800, [{"count": 14967}]],
            [1708484400, [{"count": 2190}]],
            [1708488000, [{"count": 14838}]],
            [1708491600, [{"count": 2131}]],
            [1708495200, [{"count": 14679}]],
            [1708498800, [{"count": 1561}]],
            [1708502400, [{"count": 15025}]],
            [1708506000, [{"count": 1889}]],
            [1708509600, [{"count": 14767}]],
            [1708513200, [{"count": 2308}]],
            [1708516800, [{"count": 14770}]],
            [1708520400, [{"count": 2218}]],
            [1708524000, [{"count": 14632}]],
            [1708527600, [{"count": 2097}]],
            [1708531200, [{"count": 16006}]],
            [1708534800, [{"count": 3603}]],
            [1708538400, [{"count": 16563}]],
            [1708542000, [{"count": 2747}]],
            [1708545600, [{"count": 15050}]],
            [1708549200, [{"count": 3068}]],
            [1708552800, [{"count": 14287}]],
            [1708556400, [{"count": 2528}]],
            [1708560000, [{"count": 13602}]],
            [1708563600, [{"count": 2275}]],
            [1708567200, [{"count": 13418}]],
            [1708570800, [{"count": 2613}]],
            [1708574400, [{"count": 13462}]],
            [1708578000, [{"count": 2810}]],
            [1708581600, [{"count": 13479}]],
            [1708585200, [{"count": 3516}]],
            [1708588800, [{"count": 13505}]],
            [1708592400, [{"count": 3306}]],
            [1708596000, [{"count": 13680}]],
            [1708599600, [{"count": 3183}]],
            [1708603200, [{"count": 13695}]],
            [1708606800, [{"count": 3683}]],
            [1708610400, [{"count": 13194}]],
            [1708614000, [{"count": 4113}]],
            [1708617600, [{"count": 13723}]],
            [1708621200, [{"count": 4472}]],
            [1708624800, [{"count": 14087}]],
            [1708628400, [{"count": 4584}]],
            [1708632000, [{"count": 12379}]],
            [1708635600, [{"count": 4977}]],
            [1708639200, [{"count": 13422}]],
            [1708642800, [{"count": 3634}]],
            [1708646400, [{"count": 12747}]],
            [1708650000, [{"count": 3507}]],
            [1708653600, [{"count": 12323}]],
            [1708657200, [{"count": 4268}]],
            [1708660800, [{"count": 11574}]],
            [1708664400, [{"count": 5407}]],
            [1708668000, [{"count": 11076}]],
            [1708671600, [{"count": 5774}]],
            [1708675200, [{"count": 10014}]],
            [1708678800, [{"count": 7112}]],
            [1708682400, [{"count": 9501}]],
            [1708686000, [{"count": 7526}]],
            [1708689600, [{"count": 9432}]],
            [1708693200, [{"count": 7673}]],
            [1708696800, [{"count": 9583}]],
            [1708700400, [{"count": 9141}]],
            [1708704000, [{"count": 10536}]],
            [1708707600, [{"count": 11196}]],
            [1708711200, [{"count": 9845}]],
            [1708714800, [{"count": 11467}]],
            [1708718400, [{"count": 12564}]],
            [1708722000, [{"count": 10125}]],
            [1708725600, [{"count": 14851}]],
            [1708729200, [{"count": 8009}]],
            [1708732800, [{"count": 16704}]],
            [1708736400, [{"count": 5264}]],
            [1708740000, [{"count": 20020}]],
            [1708743600, [{"count": 2668}]],
            [1708747200, [{"count": 19359}]],
            [1708750800, [{"count": 4778}]],
            [1708754400, [{"count": 18419}]],
            [1708758000, [{"count": 5173}]],
            [1708761600, [{"count": 17030}]],
            [1708765200, [{"count": 6695}]],
            [1708768800, [{"count": 15558}]],
            [1708772400, [{"count": 8122}]],
            [1708776000, [{"count": 14598}]],
            [1708779600, [{"count": 8697}]],
            [1708783200, [{"count": 13391}]],
            [1708786800, [{"count": 10225}]],
            [1708790400, [{"count": 12149}]],
            [1708794000, [{"count": 11796}]],
            [1708797600, [{"count": 10663}]],
            [1708801200, [{"count": 12875}]],
            [1708804800, [{"count": 8893}]],
            [1708808400, [{"count": 14547}]],
            [1708812000, [{"count": 7453}]],
            [1708815600, [{"count": 15791}]],
            [1708819200, [{"count": 6508}]],
            [1708822800, [{"count": 17533}]],
            [1708826400, [{"count": 4651}]],
            [1708830000, [{"count": 18928}]],
            [1708833600, [{"count": 3451}]],
            [1708837200, [{"count": 20631}]],
            [1708840800, [{"count": 2536}]],
            [1708844400, [{"count": 21025}]],
            [1708848000, [{"count": 1592}]],
            [1708851600, [{"count": 21083}]],
            [1708855200, [{"count": 2447}]],
            [1708858800, [{"count": 19939}]],
            [1708862400, [{"count": 3749}]],
            [1708866000, [{"count": 17698}]],
            [1708869600, [{"count": 5639}]],
            [1708873200, [{"count": 16175}]],
            [1708876800, [{"count": 7737}]],
            [1708880400, [{"count": 13978}]],
            [1708884000, [{"count": 9768}]],
            [1708887600, [{"count": 11512}]],
            [1708891200, [{"count": 12200}]],
            [1708894800, [{"count": 9123}]],
            [1708898400, [{"count": 14662}]],
            [1708902000, [{"count": 7551}]],
            [1708905600, [{"count": 16640}]],
            [1708909200, [{"count": 5684}]],
            [1708912800, [{"count": 18273}]],
            [1708916400, [{"count": 3760}]],
            [1708920000, [{"count": 20434}]],
            [1708923600, [{"count": 2516}]],
            [1708927200, [{"count": 20631}]],
            [1708930800, [{"count": 3681}]],
            [1708934400, [{"count": 19223}]],
            [1708938000, [{"count": 6312}]],
            [1708941600, [{"count": 17297}]],
            [1708945200, [{"count": 8178}]],
            [1708948800, [{"count": 14087}]],
            [1708952400, [{"count": 10617}]],
            [1708956000, [{"count": 11088}]],
            [1708959600, [{"count": 14358}]],
            [1708963200, [{"count": 4499}]],
            [1708966800, [{"count": 15871}]],
            [1708970400, [{"count": 12997}]],
            [1708974000, [{"count": 4899}]],
            [1708977600, [{"count": 15800}]],
            [1708981200, [{"count": 14620}]],
            [1708984800, [{"count": 2371}]],
            [1708988400, [{"count": 1816}]],
            [1708992000, [{"count": 15146}]],
            [1708995600, [{"count": 1536}]],
            [1708999200, [{"count": 14745}]],
            [1709002800, [{"count": 1679}]],
            [1709006400, [{"count": 14895}]],
            [1709010000, [{"count": 2711}]],
            [1709013600, [{"count": 14379}]],
            [1709017200, [{"count": 2769}]],
            [1709020800, [{"count": 14788}]],
            [1709024400, [{"count": 2616}]],
            [1709028000, [{"count": 14707}]],
            [1709031600, [{"count": 3178}]],
            [1709035200, [{"count": 14441}]],
            [1709038800, [{"count": 3129}]],
            [1709042400, [{"count": 14371}]],
            [1709046000, [{"count": 3153}]],
            [1709049600, [{"count": 15993}]],
            [1709053200, [{"count": 2152}]],
            [1709056800, [{"count": 16410}]],
            [1709060400, [{"count": 4357}]],
            [1709064000, [{"count": 13548}]],
            [1709067600, [{"count": 5802}]],
            [1709071200, [{"count": 12633}]],
            [1709074800, [{"count": 7708}]],
            [1709078400, [{"count": 9670}]],
            [1709082000, [{"count": 10221}]],
            [1709085600, [{"count": 7136}]],
            [1709089200, [{"count": 12421}]],
            [1709092800, [{"count": 5013}]],
            [1709096400, [{"count": 15042}]],
            [1709100000, [{"count": 3100}]],
            [1709103600, [{"count": 16550}]],
            [1709107200, [{"count": 2589}]],
            [1709110800, [{"count": 15497}]],
            [1709114400, [{"count": 4669}]],
            [1709118000, [{"count": 12856}]],
            [1709121600, [{"count": 8277}]],
            [1709125200, [{"count": 9106}]],
            [1709128800, [{"count": 12240}]],
            [1709132400, [{"count": 6318}]],
            [1709136000, [{"count": 16460}]],
            [1709139600, [{"count": 2476}]],
            [1709143200, [{"count": 16544}]],
            [1709146800, [{"count": 5756}]],
            [1709150400, [{"count": 12986}]],
            [1709154000, [{"count": 9835}]],
            [1709157600, [{"count": 10401}]],
            [1709161200, [{"count": 17037}]],
            [1709164800, [{"count": 5993}]],
            [1709168400, [{"count": 13304}]],
            [1709172000, [{"count": 15845}]],
            [1709175600, [{"count": 3491}]],
            [1709179200, [{"count": 15468}]],
            [1709182800, [{"count": 13779}]],
            [1709186400, [{"count": 4818}]],
            [1709190000, [{"count": 17597}]],
            [1709193600, [{"count": 8643}]],
            [1709197200, [{"count": 10273}]],
            [1709200800, [{"count": 15905}]],
            [1709204400, [{"count": 4808}]],
            [1709208000, [{"count": 13699}]],
            [1709211600, [{"count": 15567}]],
            [1709215200, [{"count": 2672}]],
            [1709218800, [{"count": 17141}]],
            [1709222400, [{"count": 13122}]],
            [1709226000, [{"count": 6169}]],
            [1709229600, [{"count": 16963}]],
            [1709233200, [{"count": 9471}]],
            [1709236800, [{"count": 9959}]],
            [1709240400, [{"count": 16844}]],
            [1709244000, [{"count": 8330}]],
            [1709247600, [{"count": 11127}]],
            [1709251200, [{"count": 17462}]],
            [1709254800, [{"count": 2966}]],
            [1709258400, [{"count": 16358}]],
            [1709262000, [{"count": 11509}]],
            [1709265600, [{"count": 7816}]],
            [1709269200, [{"count": 17828}]],
            [1709272800, [{"count": 4733}]],
            [1709276400, [{"count": 13701}]],
            [1709280000, [{"count": 15098}]],
            [1709283600, [{"count": 4452}]],
            [1709287200, [{"count": 15974}]],
            [1709290800, [{"count": 11116}]],
            [1709294400, [{"count": 6696}]],
            [1709298000, [{"count": 15310}]],
            [1709301600, [{"count": 10326}]],
            [1709305200, [{"count": 9908}]],
            [1709308800, [{"count": 18435}]],
            [1709312400, [{"count": 4521}]],
            [1709316000, [{"count": 17089}]],
            [1709319600, [{"count": 14834}]],
            [1709323200, [{"count": 5068}]],
            [1709326800, [{"count": 16853}]],
            [1709330400, [{"count": 15995}]],
            [1709334000, [{"count": 4204}]],
            [1709337600, [{"count": 16755}]],
            [1709341200, [{"count": 14201}]],
            [1709344800, [{"count": 2401}]],
            [1709348400, [{"count": 16521}]],
            [1709352000, [{"count": 14508}]],
            [1709355600, [{"count": 4919}]],
            [1709359200, [{"count": 16605}]],
            [1709362800, [{"count": 13105}]],
            [1709366400, [{"count": 5016}]],
            [1709370000, [{"count": 16285}]],
            [1709373600, [{"count": 12780}]],
            [1709377200, [{"count": 6172}]],
            [1709380800, [{"count": 16813}]],
            [1709384400, [{"count": 11275}]],
            [1709388000, [{"count": 6247}]],
            [1709391600, [{"count": 16729}]],
            [1709395200, [{"count": 11077}]],
            [1709398800, [{"count": 6823}]],
            [1709402400, [{"count": 16394}]],
            [1709406000, [{"count": 11272}]],
            [1709409600, [{"count": 6072}]],
            [1709413200, [{"count": 13712}]],
            [1709416800, [{"count": 13233}]],
            [1709420400, [{"count": 5200}]],
            [1709424000, [{"count": 16477}]],
            [1709427600, [{"count": 13145}]],
            [1709431200, [{"count": 4581}]],
            [1709434800, [{"count": 16215}]],
            [1709438400, [{"count": 13137}]],
            [1709442000, [{"count": 5527}]],
            [1709445600, [{"count": 14986}]],
            [1709449200, [{"count": 15543}]],
            [1709452800, [{"count": 3451}]],
            [1709456400, [{"count": 16428}]],
            [1709460000, [{"count": 14203}]],
            [1709463600, [{"count": 3500}]],
            [1709467200, [{"count": 16171}]],
            [1709470800, [{"count": 13823}]],
            [1709474400, [{"count": 3403}]],
            [1709478000, [{"count": 15955}]],
            [1709481600, [{"count": 14180}]],
            [1709485200, [{"count": 3720}]],
            [1709488800, [{"count": 15064}]],
            [1709492400, [{"count": 15594}]],
            [1709496000, [{"count": 4556}]],
            [1709499600, [{"count": 12252}]],
            [1709503200, [{"count": 15673}]],
            [1709506800, [{"count": 6523}]],
            [1709510400, [{"count": 11642}]],
            [1709514000, [{"count": 14775}]],
            [1709517600, [{"count": 8294}]],
            [1709521200, [{"count": 9684}]],
            [1709524800, [{"count": 15337}]],
            [1709528400, [{"count": 13471}]],
            [1709532000, [{"count": 4664}]],
            [1709535600, [{"count": 16647}]],
            [1709539200, [{"count": 14451}]],
            [1709542800, [{"count": 5682}]],
            [1709546400, [{"count": 15629}]],
            [1709550000, [{"count": 14739}]],
            [1709553600, [{"count": 3647}]],
            [1709557200, [{"count": 15035}]],
            [1709560800, [{"count": 15231}]],
            [1709564400, [{"count": 5420}]],
            [1709568000, [{"count": 14403}]],
            [1709571600, [{"count": 16403}]],
            [1709575200, [{"count": 8910}]],
            [1709578800, [{"count": 11069}]],
            [1709582400, [{"count": 16416}]],
            [1709586000, [{"count": 14075}]],
            [1709589600, [{"count": 3948}]],
            [1709593200, [{"count": 17691}]],
            [1709596800, [{"count": 15163}]],
            [1709600400, [{"count": 3408}]],
            [1709604000, [{"count": 15009}]],
            [1709607600, [{"count": 16203}]],
            [1709611200, [{"count": 4116}]],
            [1709614800, [{"count": 15122}]],
            [1709618400, [{"count": 14334}]],
            [1709622000, [{"count": 5510}]],
            [1709625600, [{"count": 12453}]],
            [1709629200, [{"count": 15794}]],
            [1709632800, [{"count": 8073}]],
            [1709636400, [{"count": 9734}]],
            [1709640000, [{"count": 15269}]],
            [1709643600, [{"count": 12877}]],
            [1709647200, [{"count": 3530}]],
            [1709650800, [{"count": 14828}]],
            [1709654400, [{"count": 8224}]],
            [1709658000, [{"count": 10738}]],
            [1709661600, [{"count": 13937}]],
            [1709665200, [{"count": 6090}]],
            [1709668800, [{"count": 16573}]],
            [1709672400, [{"count": 14367}]],
            [1709676000, [{"count": 5296}]],
            [1709679600, [{"count": 16536}]],
            [1709683200, [{"count": 14513}]],
            [1709686800, [{"count": 4536}]],
            [1709690400, [{"count": 16075}]],
            [1709694000, [{"count": 14517}]],
            [1709697600, [{"count": 2885}]],
            [1709701200, [{"count": 17312}]],
            [1709704800, [{"count": 16253}]],
            [1709708400, [{"count": 3134}]],
            [1709712000, [{"count": 17030}]],
            [1709715600, [{"count": 16245}]],
            [1709719200, [{"count": 9540}]],
            [1709722800, [{"count": 9333}]],
            [1709726400, [{"count": 16006}]],
            [1709730000, [{"count": 11666}]],
            [1709733600, [{"count": 8078}]],
            [1709737200, [{"count": 17435}]],
            [1709740800, [{"count": 13290}]],
            [1709744400, [{"count": 5941}]],
            [1709748000, [{"count": 16719}]],
            [1709751600, [{"count": 14362}]],
            [1709755200, [{"count": 3991}]],
            [1709758800, [{"count": 15702}]],
            [1709762400, [{"count": 16069}]],
            [1709766000, [{"count": 4612}]],
            [1709769600, [{"count": 14909}]],
            [1709773200, [{"count": 16784}]],
            [1709776800, [{"count": 4988}]],
            [1709780400, [{"count": 13585}]],
            [1709784000, [{"count": 16621}]],
            [1709787600, [{"count": 5771}]],
            [1709791200, [{"count": 12513}]],
            [1709794800, [{"count": 17802}]],
            [1709798400, [{"count": 8084}]],
            [1709802000, [{"count": 13363}]],
            [1709805600, [{"count": 15824}]],
            [1709809200, [{"count": 10396}]],
            [1709812800, [{"count": 8387}]],
            [1709816400, [{"count": 3435}]],
            [1709820000, [{"count": 16175}]],
            [1709823600, [{"count": 14053}]],
            [1709827200, [{"count": 6096}]],
            [1709830800, [{"count": 17161}]],
            [1709834400, [{"count": 15957}]],
        ],
        "order": 1,
        "isMetricsData": True,
        "start": 1707951600,
        "end": 1709838000,
        "meta": {
            "fields": {"time": "date", "p95_transaction_duration": "duration", "count": "integer"},
            "units": {"time": None, "p95_transaction_duration": "millisecond", "count": None},
            "isMetricsData": True,
            "isMetricsExtractedData": False,
            "tips": {},
            "datasetReason": "unchanged",
            "dataset": "metrics",
        },
    },
}

METRICS_ENHANCED_REFERRERS: set[str] = {
    Referrer.API_PERFORMANCE_HOMEPAGE_WIDGET_CHART.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_DURATION_HISTOGRAM.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_LCP_HISTOGRAM.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_FCP_HISTOGRAM.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_FID_HISTOGRAM.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_APDEX_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_P50_DURATION_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_P75_DURATION_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_P95_DURATION_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_P99_DURATION_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_P75_LCP_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_TPM_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_FAILURE_RATE_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_USER_MISERY_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_WORST_LCP_VITALS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_WORST_FCP_VITALS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_WORST_CLS_VITALS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_WORST_FID_VITALS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_IMRPOVED.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_REGRESSED.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_RELATED_ERRORS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_RELATED_ISSUES.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_SLOW_HTTP_OPS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_SLOW_DB_OPS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_SLOW_RESOURCE_OPS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_SLOW_BROWSER_OPS.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_COLD_STARTUP_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_WARM_STARTUP_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_SLOW_FRAMES_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_FROZEN_FRAMES_AREA.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_SLOW_FRAMES.value,
    Referrer.API_PERFORMANCE_GENERIC_WIDGET_CHART_MOST_FROZEN_FRAMES.value,
    Referrer.API_STARFISH_SPAN_CATEGORY_BREAKDOWN_CHART.value,
    Referrer.API_STARFISH_ENDPOINT_OVERVIEW.value,
    Referrer.API_STARFISH_HTTP_ERROR_COUNT.value,
    Referrer.API_STARFISH_SPAN_SUMMARY_PAGE_CHART.value,
    Referrer.API_STARFISH_SIDEBAR_SPAN_METRICS_CHART.value,
    Referrer.API_STARFISH_SPAN_TIME_CHARTS.value,
    Referrer.API_STARFISH_MOBILE_SCREEN_METRICS_SERIES.value,
    Referrer.API_PERFORMANCE_MOBILE_UI_SERIES.value,
}


ALLOWED_EVENTS_STATS_REFERRERS: set[str] = {
    Referrer.API_ALERTS_ALERT_RULE_CHART.value,
    Referrer.API_ALERTS_CHARTCUTERIE.value,
    Referrer.API_DASHBOARDS_WIDGET_AREA_CHART.value,
    Referrer.API_DASHBOARDS_WIDGET_BAR_CHART.value,
    Referrer.API_DASHBOARDS_WIDGET_LINE_CHART.value,
    Referrer.API_DASHBOARDS_TOP_EVENTS.value,
    Referrer.API_DISCOVER_PREBUILT_CHART.value,
    Referrer.API_DISCOVER_PREVIOUS_CHART.value,
    Referrer.API_DISCOVER_DEFAULT_CHART.value,
    Referrer.API_DISCOVER_DAILY_CHART.value,
    Referrer.API_DISCOVER_TOP5_CHART.value,
    Referrer.API_DISCOVER_DAILYTOP5_CHART.value,
    Referrer.API_PERFORMANCE_HOMEPAGE_DURATION_CHART.value,
    Referrer.API_PERFORMANCE_HOMEPAGE_WIDGET_CHART.value,
    Referrer.API_PERFORMANCE_TRANSACTION_SUMMARY_SIDEBAR_CHART.value,
    Referrer.API_PERFORMANCE_TRANSACTION_SUMMARY_VITALS_CHART.value,
    Referrer.API_PERFORMANCE_TRANSACTION_SUMMARY_TRENDS_CHART.value,
    Referrer.API_PERFORMANCE_TRANSACTION_SUMMARY_DURATION.value,
    Referrer.API_PROFILING_LANDING_CHART.value,
    Referrer.API_PROFILING_PROFILE_SUMMARY_CHART.value,
    Referrer.API_RELEASES_RELEASE_DETAILS_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_LANDING_DURATION_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_LANDING_RESPONSE_CODE_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_LANDING_THROUGHPUT_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_DOMAIN_SUMMARY_DURATION_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_DOMAIN_SUMMARY_RESPONSE_CODE_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_DOMAIN_SUMMARY_THROUGHPUT_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_SAMPLES_PANEL_DURATION_CHART.value,
    Referrer.API_PERFORMANCE_HTTP_SAMPLES_PANEL_RESPONSE_CODE_CHART.value,
    Referrer.API_PERFORMANCE_SPAN_SUMMARY_DURATION_CHART.value,
    Referrer.API_PERFORMANCE_SPAN_SUMMARY_THROUGHPUT_CHART.value,
    Referrer.API_PERFORMANCE_SPAN_SUMMARY_TRANSACTION_THROUGHPUT_CHART.value,
}


@region_silo_endpoint
class OrganizationEventsStatsEndpoint(OrganizationEventsV2EndpointBase):
    publish_status = {
        "GET": ApiPublishStatus.UNKNOWN,
    }

    def get_features(self, organization: Organization, request: Request) -> Mapping[str, bool]:
        feature_names = [
            "organizations:performance-chart-interpolation",
            "organizations:performance-use-metrics",
            "organizations:dashboards-mep",
            "organizations:mep-rollout-flag",
            "organizations:use-metrics-layer",
            "organizations:starfish-view",
            "organizations:on-demand-metrics-extraction",
            "organizations:on-demand-metrics-extraction-widgets",
        ]
        batch_features = features.batch_has(
            feature_names,
            organization=organization,
            actor=request.user,
        )
        return (
            batch_features.get(f"organization:{organization.id}", {})
            if batch_features is not None
            else {
                feature_name: features.has(
                    feature_name, organization=organization, actor=request.user
                )
                for feature_name in feature_names
            }
        )

    def flatten_results(self, results: SnubaTSResult | dict[str, SnubaTSResult]):
        if isinstance(results, SnubaTSResult):
            return results.data["data"]
        else:
            return sum(
                [timeseries_result.data["data"] for timeseries_result in results.values()],
                [],
            )

    def check_if_results_have_data(self, results: SnubaTSResult | dict[str, SnubaTSResult]):
        flattened_data = self.flatten_results(results)
        has_data = any(
            any(
                column_name != "time"
                and isinstance(column_value, (int, float))
                and column_value != 0
                for (column_name, column_value) in row.items()
            )
            for row in flattened_data
        )
        return has_data

    def get(self, request: Request, organization: Organization) -> Response:
        return Response(
            DATA,
            status=200,
        )
        with sentry_sdk.start_span(op="discover.endpoint", description="filter_params") as span:
            span.set_data("organization", organization)

            top_events = 0

            if "topEvents" in request.GET:
                try:
                    top_events = int(request.GET.get("topEvents", 0))
                except ValueError:
                    return Response({"detail": "topEvents must be an integer"}, status=400)
                if top_events > MAX_TOP_EVENTS:
                    return Response(
                        {"detail": f"Can only get up to {MAX_TOP_EVENTS} top events"},
                        status=400,
                    )
                elif top_events <= 0:
                    return Response({"detail": "If topEvents needs to be at least 1"}, status=400)

            comparison_delta = None
            if "comparisonDelta" in request.GET:
                try:
                    comparison_delta = timedelta(seconds=int(request.GET["comparisonDelta"]))
                except ValueError:
                    return Response({"detail": "comparisonDelta must be an integer"}, status=400)

            # The partial parameter determines whether or not partial buckets are allowed.
            # The last bucket of the time series can potentially be a partial bucket when
            # the start of the bucket does not align with the rollup.
            allow_partial_buckets = request.GET.get("partial") == "1"

            include_other = request.GET.get("excludeOther") != "1"

            referrer = request.GET.get("referrer")
            referrer = (
                referrer
                if referrer in ALLOWED_EVENTS_STATS_REFERRERS.union(METRICS_ENHANCED_REFERRERS)
                else Referrer.API_ORGANIZATION_EVENT_STATS.value
            )
            batch_features = self.get_features(organization, request)
            has_chart_interpolation = batch_features.get(
                "organizations:performance-chart-interpolation", False
            )
            use_metrics = (
                batch_features.get("organizations:performance-use-metrics", False)
                or batch_features.get("organizations:dashboards-mep", False)
                or (
                    batch_features.get("organizations:mep-rollout-flag", False)
                    and features.has(
                        "organizations:dynamic-sampling",
                        organization=organization,
                        actor=request.user,
                    )
                )
            )

            dataset = self.get_dataset(request)
            # Add more here until top events is supported on all the datasets
            if top_events > 0:
                dataset = (
                    dataset
                    if dataset
                    in [
                        discover,
                        functions,
                        metrics_performance,
                        metrics_enhanced_performance,
                        spans_indexed,
                        spans_metrics,
                    ]
                    else discover
                )

            metrics_enhanced = dataset in {metrics_performance, metrics_enhanced_performance}

            allow_metric_aggregates = request.GET.get("preventMetricAggregates") != "1"
            sentry_sdk.set_tag("performance.metrics_enhanced", metrics_enhanced)

        try:
            use_on_demand_metrics, on_demand_metrics_type = self.handle_on_demand(request)
        except ValueError:
            metric_type_values = [e.value for e in MetricSpecType]
            metric_types = ",".join(metric_type_values)
            return Response({"detail": f"Metric type must be one of: {metric_types}"}, status=400)

        force_metrics_layer = request.GET.get("forceMetricsLayer") == "True"

        def _get_event_stats(
            scoped_dataset: Any,
            query_columns: Sequence[str],
            query: str,
            params: dict[str, str],
            rollup: int,
            zerofill_results: bool,
            comparison_delta: datetime | None,
        ) -> SnubaTSResult:
            if top_events > 0:
                return scoped_dataset.top_events_timeseries(
                    timeseries_columns=query_columns,
                    selected_columns=self.get_field_list(organization, request),
                    equations=self.get_equation_list(organization, request),
                    user_query=query,
                    params=params,
                    orderby=self.get_orderby(request),
                    rollup=rollup,
                    limit=top_events,
                    organization=organization,
                    referrer=referrer + ".find-topn",
                    allow_empty=False,
                    zerofill_results=zerofill_results,
                    on_demand_metrics_enabled=use_on_demand_metrics,
                    on_demand_metrics_type=on_demand_metrics_type,
                    include_other=include_other,
                )

            return scoped_dataset.timeseries_query(
                selected_columns=query_columns,
                query=query,
                params=params,
                rollup=rollup,
                referrer=referrer,
                zerofill_results=zerofill_results,
                comparison_delta=comparison_delta,
                allow_metric_aggregates=allow_metric_aggregates,
                has_metrics=use_metrics,
                # We want to allow people to force use the new metrics layer in the query builder. We decided to go for
                # this approach so that we can have only a subset of parts of sentry that use the new metrics layer for
                # their queries since right now the metrics layer has not full feature parity with the query builder.
                use_metrics_layer=force_metrics_layer
                or batch_features.get("organizations:use-metrics-layer", False),
                on_demand_metrics_enabled=use_on_demand_metrics
                and (
                    batch_features.get("organizations:on-demand-metrics-extraction", False)
                    or batch_features.get(
                        "organizations:on-demand-metrics-extraction-widgets", False
                    )
                ),
                on_demand_metrics_type=on_demand_metrics_type,
            )

        def get_event_stats_factory(scoped_dataset):
            """
            This factory closes over dataset in order to make an additional request to the errors dataset
            in the case that this request is from a dashboard widget and we're trying to split their discover dataset.

            This should be removed once the discover dataset is completely split in dashboards.
            """
            dashboard_widget_id = request.GET.get("dashboardWidgetId", None)

            def fn(
                query_columns: Sequence[str],
                query: str,
                params: dict[str, str],
                rollup: int,
                zerofill_results: bool,
                comparison_delta: datetime | None,
            ) -> SnubaTSResult:

                if not (metrics_enhanced and dashboard_widget_id):
                    return _get_event_stats(
                        scoped_dataset,
                        query_columns,
                        query,
                        params,
                        rollup,
                        zerofill_results,
                        comparison_delta,
                    )

                try:
                    widget = DashboardWidget.objects.get(id=dashboard_widget_id)
                    does_widget_have_split = widget.discover_widget_split is not None
                    has_override_feature = features.has(
                        "organizations:performance-discover-widget-split-override-save",
                        organization,
                        actor=request.user,
                    )

                    if does_widget_have_split and not has_override_feature:
                        # This is essentially cached behaviour and we skip the check
                        split_query = query
                        if widget.discover_widget_split == DashboardWidgetTypes.ERROR_EVENTS:
                            split_dataset = discover
                            split_query = f"({query}) AND !event.type:transaction"
                        elif widget.discover_widget_split == DashboardWidgetTypes.TRANSACTION_LIKE:
                            # We can't add event.type:transaction for now because of on-demand.
                            split_dataset = scoped_dataset
                        else:
                            # This is a fallback for the ambiguous case.
                            split_dataset = discover

                        return _get_event_stats(
                            split_dataset,
                            query_columns,
                            split_query,
                            params,
                            rollup,
                            zerofill_results,
                            comparison_delta,
                        )

                    # Widget has not split the discover dataset yet, so we need to check if there are errors etc.
                    errors_only_query = f"({query}) AND !event.type:transaction"
                    error_results = None
                    try:
                        error_results = _get_event_stats(
                            discover,
                            query_columns,
                            errors_only_query,
                            params,
                            rollup,
                            zerofill_results,
                            comparison_delta,
                        )
                        has_errors = self.check_if_results_have_data(error_results)
                    except SnubaError:
                        has_errors = False

                    original_results = _get_event_stats(
                        scoped_dataset,
                        query_columns,
                        query,
                        params,
                        rollup,
                        zerofill_results,
                        comparison_delta,
                    )
                    has_other_data = self.check_if_results_have_data(original_results)
                    if isinstance(original_results, SnubaTSResult):
                        dataset_meta = original_results.data.get("meta", {})
                    else:
                        dataset_meta = list(original_results.values())[0].data.get("meta", {})

                    using_metrics = dataset_meta.get("isMetricsData", False) or dataset_meta.get(
                        "isMetricsExtractedData", False
                    )

                    has_transactions = has_other_data
                    transaction_results = None
                    if has_errors and has_other_data and not using_metrics:
                        # In the case that the original request was not using the metrics dataset, we cannot be certain that other data is solely transactions.
                        sentry_sdk.set_tag("third_split_query", True)
                        transactions_only_query = f"({query}) AND event.type:transaction"
                        transaction_results = _get_event_stats(
                            discover,
                            query_columns,
                            transactions_only_query,
                            params,
                            rollup,
                            zerofill_results,
                            comparison_delta,
                        )
                        has_transactions = self.check_if_results_have_data(transaction_results)

                    decision = self.save_split_decision(widget, has_errors, has_transactions)

                    if decision == DashboardWidgetTypes.DISCOVER:
                        # The user needs to be warned to split in this case.
                        return _get_event_stats(
                            discover,
                            query_columns,
                            query,
                            params,
                            rollup,
                            zerofill_results,
                            comparison_delta,
                        )
                    elif decision == DashboardWidgetTypes.TRANSACTION_LIKE:
                        return original_results
                    elif decision == DashboardWidgetTypes.ERROR_EVENTS and error_results:
                        return error_results
                    else:
                        return original_results

                except Exception as e:
                    # Swallow the exception if it was due to discover split, and try again one more time.
                    sentry_sdk.capture_exception(e)
                    return _get_event_stats(
                        scoped_dataset,
                        query_columns,
                        query,
                        params,
                        rollup,
                        zerofill_results,
                        comparison_delta,
                    )

            return fn

        get_event_stats = get_event_stats_factory(dataset)

        try:
            return Response(
                self.get_event_stats_data(
                    request,
                    organization,
                    get_event_stats,
                    top_events,
                    allow_partial_buckets=allow_partial_buckets,
                    zerofill_results=not (
                        request.GET.get("withoutZerofill") == "1" and has_chart_interpolation
                    ),
                    comparison_delta=comparison_delta,
                    dataset=dataset,
                ),
                status=200,
            )
        except ValidationError:
            return Response({"detail": "Comparison period is outside retention window"}, status=400)
