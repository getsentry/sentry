{% extends "sentry/projects/manage.html" %}

{% load i18n %}
{% load sentry_helpers %}
{% load sentry_plugins %}

{% block title %}{% trans "Manage Integrations" %} | {{ block.super }}{% endblock %}

{% block main %}
    {% if page == 'issue-tracking' %}
      <h2>{% trans "Issue Tracking Integrations" %}</h2>
      <p>
        Enabling Issue Tracking will let you quickly create tasks within your existing tools.
        You'll find the new action on an issue's details page. Once you create an issue, you'll
        find a helpful annotation and link to the task in your project management tool.
      </p>
    {% elif page == 'notification' %}
      <h2>{% trans "Notification Integrations" %}</h2>
      <p>
        After adding a notification method to a project, you can add custom alert rules for
        the integration from your project's
        <a href="/{{ organization.slug }}/{{ project.slug }}/settings/alerts/rules/">
        alert settings page</a>.
      </p>
    {% else %}
      <h2>{% trans "Integrations" %}</h2>
    {% endif %}

    {% if plugins_with_status %}
      <div class="panel panel-default">
        <table class="table integrations simple">
            <tbody>
              <tr>
                {% for plugin, is_enabled in plugins_with_status %}
                    <td class="{{ plugin.get_title|slugify }} {% if not is_enabled %}disabled{% endif %}">
                      {% if plugin.has_project_conf %}
                        <a href="{% url 'sentry-configure-project-plugin' project.organization.slug project.slug plugin.slug %}"
                           class="icon-integration icon-{{ plugin.get_title|slugify }}"></a>
                        <h5>{{ plugin.get_title }}</h5>
                      {% else %}
                        <form method="POST">
                          {% csrf_token %}
                          <input type="hidden" name="op" value="{% if is_enabled %}disable{% else %}enable{% endif %}" />
                          <input type="hidden" name="plugin" value="{{ plugin.slug }}" />
                          <button type="submit" class="icon-integration icon-{{ plugin.get_title|slugify }}"></button>
                        </form>
                        <h5>{{ plugin.get_title }}</h5>
                      {% endif %}
                    </td>
                    {% if forloop.last %}
                      </tr>
                    {% else %}
                      {% if forloop.counter|divisibleby:"3" %}
                        </tr><tr>
                      {% endif %}
                    {% endif %}
                {% endfor %}
            </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-info alert-block">
        <p>
          {% trans "There are no integrations available. Ask your Sentry team about integrating with your favorite tools." %}
        </p>
      </div>
    {% endif %}
  <script type="text/javascript">
    (function() {
      $('form').on('submit', function(ev) {
        // TODO(jess): move this to modal once this page is in react
        var op = $(ev.target).find('[name="op"]').val();
        return window.confirm('Are you sure you want to ' + op + ' this plugin?');
      });
    })();
  </script>
{% endblock %}
