{% extends "sentry/bases/modal.html" %}

{% block preload_data %}
{% endblock %}

{% load crispy_forms_tags %}
{% load i18n %}
{% load sentry_assets %}

{% block wrapperclass %}narrow auth org-login{% endblock %}

{% block content %}
<div class="pattern-bg"></div>

<div class="box">
  <div class="auth-sidebar">
    <a href="https://sentry.io/welcome/">
      <span class="icon-sentry-logo"></span>
    </a>
  </div>
  <section class="org-login">
    {% block auth_container %}
      <div class="auth-container p-y-2">
        {% block auth_main %}{% endblock %}
        <p class="m-t-1">
          {% blocktrans %}
            Need help with your account?  Click <a class="help-center-link" href="https://sentry.zendesk.com/hc/en-us">here</a> to check out our help center.
          {% endblocktrans %}
        </p>
      </div>
    {% endblock %}
  </section>
</div>

{% endblock %}

{% block footer %}
{% endblock %}

{% block scripts %}
{{ block.super }}
{% script %}
<script>
  // HACK(jferge+claude): inline getCookie function from our utils,
  // update the csrf token value in a rudimentary way (timer based)
  // on auth forms to help out when users have multiple sentry tabs
  // and are logged out
  (function() {
    function getCookie(name) {
      if (document.cookie && document.cookie !== '') {
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
          var cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === name + '=') {
            return decodeURIComponent(cookie.substring(name.length + 1));
          }
        }
      }
      return null;
    }

    setInterval(function() {
      var csrfCookieVal = getCookie(window.csrfCookieName || 'sc');
      // combine strings for csrf name as some tests grep on the token name :(
      var csrfName = 'csrf' + 'middleware' + 'token';
      var csrfEls = document.getElementsByName(csrfName);
      if (csrfEls.length > 0 && csrfCookieVal) {
        for (var i = 0; i < csrfEls.length; i++) {
          csrfEls[i].value = csrfCookieVal;
        }
      }
    }, 200);
  })();
</script>
{% endscript %}
{% endblock %}
