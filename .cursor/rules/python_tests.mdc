---
description: Guidelines for writing python tests
globs: tests/**/*.py,**/test_*.py
alwaysApply: false
---

# Python tests

## Available Rule Files

This workspace has several rule files available to provide specific guidance:

- **python_tests**: Guidelines for writing Python tests (this file)
- **tsx_tests**: Rules and guidelines for running *.spec.tsx tests and writing React tests

For information about adding new tools, prompts, or extending these guidelines, consult the team leads or refer to the workspace documentation.

## Use factories instead of directly calling `Model.objects.create`

In Sentry Python tests, prefer using factory methods from `sentry.testutils.factories.Factories` @factories.py or fixture methods (e.g., `self.create_model`) provided by base classes like `sentry.testutils.fixtures.Fixtures` @fixtures.py  instead of directly calling `Model.objects.create`. This promotes consistency, reduces boilerplate, and leverages shared test setup logic defined in the factories.

For example, a diff that uses a fixture instead of the directly calling `Model.objects.create`  would look like:

```diff
    -        direct_project = Project.objects.create(
    -            organization=self.organization,
    -            name="Directly Created",
    -            slug="directly-created"
    -        )
    +        direct_project = self.create_project(
    +            organization=self.organization,
    +            name="Directly Created",
    +            slug="directly-created" # Note: Ensure factory args match
    +        )
```
