{
  "id": "python-tracing",
  "name": "Python",
  "html": "<p>To manually instrument certain regions of your code, you can create a transaction to capture them.</p>\n<p>The following example creates a transaction for a scope that contains an expensive operation (for example, <code>process_item</code>), and sends the result to Sentry:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python highlight\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentry_sdk <span class=\"token keyword\">import</span> start_transaction\n\n<span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span>\n  item <span class=\"token operator\">=</span> get_from_queue<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">with</span> start_transaction<span class=\"token punctuation\">(</span>op<span class=\"token operator\">=</span><span class=\"token string\">\"task\"</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">=</span>item<span class=\"token punctuation\">.</span>get_transaction_name<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n      <span class=\"token comment\"># process_item may create more spans internally (see next examples)</span>\n      process_item<span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Adding More Spans to the Transaction</strong></p>\n<p>The next example contains the implementation of the hypothetical <code>process_item</code> function called from the code snippet in the previous section. Our SDK can determine if there is currently an open transaction and add all newly created spans as child operations to that transaction. Keep in mind that each individual span also needs to be manually finished; otherwise, spans will not show up in the transaction. When using spans and transactions as context managers, they are automatically finished at the end of the <code>with</code> block.</p>\n<p>In cases where you want to attach Spans to an already ongoing Transaction you can use <code>Hub.current.scope.transaction</code>. This property will return a <code>Transaction</code> in case there is a running Transaction otherwise it returns <code>None</code>.</p>\n<p>Alternatively, instead of adding to the top-level transaction, you can make a child span of the current span, if there is one. Use <code>Hub.current.scope.span</code> in that case.</p>\n<p>You can choose the values of <code>op</code> and <code>description</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python highlight\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentry_sdk <span class=\"token keyword\">import</span> Hub\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">process_item</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    transaction <span class=\"token operator\">=</span> Hub<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>scope<span class=\"token punctuation\">.</span>transaction\n    <span class=\"token comment\"># omitted code...</span>\n    <span class=\"token keyword\">with</span> transaction<span class=\"token punctuation\">.</span>start_child<span class=\"token punctuation\">(</span>op<span class=\"token operator\">=</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"GET /\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> span<span class=\"token punctuation\">:</span>\n        response <span class=\"token operator\">=</span> my_custom_http_library<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n        span<span class=\"token punctuation\">.</span>set_tag<span class=\"token punctuation\">(</span><span class=\"token string\">\"http.status_code\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">)</span>\n        span<span class=\"token punctuation\">.</span>set_data<span class=\"token punctuation\">(</span><span class=\"token string\">\"http.foobarsessionid\"</span><span class=\"token punctuation\">,</span> get_foobar_sessionid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The alternative to make a tree of spans:</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python highlight\"><code class=\"language-python\"><span class=\"token keyword\">from</span> sentry_sdk <span class=\"token keyword\">import</span> Hub\n\n<span class=\"token keyword\">def</span> <span class=\"token function\">process_item</span><span class=\"token punctuation\">(</span>item<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    parent_span <span class=\"token operator\">=</span> Hub<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>scope<span class=\"token punctuation\">.</span>span\n    <span class=\"token comment\"># omitted code...</span>\n    <span class=\"token keyword\">with</span> parent_span<span class=\"token punctuation\">.</span>start_child<span class=\"token punctuation\">(</span>op<span class=\"token operator\">=</span><span class=\"token string\">\"http\"</span><span class=\"token punctuation\">,</span> description<span class=\"token operator\">=</span><span class=\"token string\">\"GET /\"</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> span<span class=\"token punctuation\">:</span>\n        response <span class=\"token operator\">=</span> my_custom_http_library<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span>\n        span<span class=\"token punctuation\">.</span>set_tag<span class=\"token punctuation\">(</span><span class=\"token string\">\"http.status_code\"</span><span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">.</span>status_code<span class=\"token punctuation\">)</span>\n        span<span class=\"token punctuation\">.</span>set_data<span class=\"token punctuation\">(</span><span class=\"token string\">\"http.foobarsessionid\"</span><span class=\"token punctuation\">,</span> get_foobar_sessionid<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>",
  "link": "https://docs.sentry.io/platforms/python/performance/"
}
