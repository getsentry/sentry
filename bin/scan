#!/bin/bash

ignored=(
    # low priority: pyyaml
    # Arbitrary code execution in full_load/SafeLoader - doesn't apply to us.
    38100

    # low priority: djangorestframework
    # XXX: This is... unfortunately not present in safety's db right now. It is in synk though:
    # https://snyk.io/vuln/SNYK-PYTHON-DJANGORESTFRAMEWORK-450194
    # XSS in the "browsable api" drf < 3.9.1 view templates - doesn't apply to us.
)

# Take additional ignores from argv.
# This enables script re-use in getsentry
if [ $# -ge 1 ]; then
    for i in "$@"; do
        ignored+=("$i")
    done
fi

args="--full-report"
for i in ${ignored[@]}; do
  args="$args --ignore=${i}"
done

exec safety check ${args}
