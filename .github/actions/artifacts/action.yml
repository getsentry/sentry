name: 'Sentry Artifacts'
description: 'Handles uploading coverage/test artifacts to codecov'

inputs:
  files:
    description: 'Path to coverage file(s) - comma separated for multiple files'
    default: '.artifacts/*.coverage.xml'
    required: true
  test_result_files:
    description: 'Path to test result file(s) - comma separated for multiple files'
    default: '.artifacts/*.junit.xml'
    required: true
  type:
    description: 'The type of change (frontend, backend)'
    default: 'backend'
    required: false
  token:
    description: 'The codecov token'
    required: true
  commit_sha:
    description: 'The commit sha'
    required: true

runs:
  using: 'composite'
  steps:
    - name: Upload to codecov
      uses: codecov/codecov-action@e0b68c6749509c5f83f984dd99a76a1c1a231044 # v4.0.1
      with:
        token: ${{ inputs.token }}
        flags: ${{ inputs.type }}
        files: ${{ inputs.files }}
        override_commit: ${{ inputs.commit_sha}}
        plugin: noop
        verbose: true
      continue-on-error: true
    - name: Upload test results to codecov
      uses: codecov/test-results-action@2b4994ec0ffe80e6c5f8fd5a2e3cfe48994b3680 # v1
      with:
        token: ${{ inputs.token }}
        files: ${{ inputs.files }}
        override_commit: ${{ inputs.commit_sha}}
        verbose: true
      continue-on-error: true
